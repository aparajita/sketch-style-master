var that=this;function run(key,context){that.context=context;var exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e){e.exports=JSON.parse('{"a":"1.0.4"}')},function(module,__webpack_exports__,__webpack_require__){"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}__webpack_require__.d(__webpack_exports__,"a",(function(){return MochaJSDelegate}));var MochaJSDelegate=function(){function MochaJSDelegate(e,t){if(_classCallCheck(this,MochaJSDelegate),this.uniqueClassName="MochaJSDelegate_DynamicClass_"+NSUUID.UUID().UUIDString(),this.delegateClassDesc=MOClassDescription.allocateDescriptionForClassWithName_superclass_(this.uniqueClassName,t||NSObject),this.delegateClassDesc.registerClass(),this.handlers={},"object"===_typeof(e))for(var n=0,r=Object.keys(e);n<r.length;n++){var i=r[n];this.setHandlerForSelector(i,e[i])}}return _createClass(MochaJSDelegate,[{key:"setHandlerForSelector",value:function setHandlerForSelector(selectorString,func){var handlerHasBeenSet=selectorString in this.handlers;if(this.handlers[selectorString]=func,!handlerHasBeenSet){for(var args=[],regex=/:/g;regex.exec(selectorString);)args.push("arg"+args.length);var body="{\n        try {\n          return func.apply(this, arguments)\n        }\n        catch(ex) {\n          log(ex)\n        }\n      }",code=NSString.stringWithFormat("(function (%@) %@)",args.join(", "),body),dynamicFunction=eval(String(code)),selector=NSSelectorFromString(selectorString);this.delegateClassDesc.addInstanceMethodWithSelector_function_(selector,dynamicFunction)}}},{key:"removeHandlerForSelector",value:function(e){delete this.handlers[e]}},{key:"getHandlerForSelector",value:function(e){return this.handlers[e]}},{key:"getAllHandlers",value:function(){return this.handlers}},{key:"getClass",value:function(){return NSClassFromString(this.uniqueClassName)}},{key:"getClassInstance",value:function(){return this.getClass().new()}}]),MochaJSDelegate}()},function(e,t){e.exports=require("sketch")},function(e,t,n){"use strict";n.r(t),n.d(t,"renameTextStyles",(function(){return g})),n.d(t,"renameLayerStyles",(function(){return v}));var r=n(0);var i=n(1);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function e(t,n,r,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var a=t.plugin.urlForResourceNamed(n).path();this._bundle=NSBundle.bundleWithPath(a),this._nibName=r,this._delegate=i,this.outlets=Object.create(null),this.ivars=Object.create(null),this._delegateProxy=null,this._createNibOwner(r);var l=this._loadConnections(r);this._prepareOutletConnections(l.outlets),i&&this._connectActionsToDelegate(l.actions,i),o&&this._addIvars(o),this._registerNibOwner(),o&&this._initIvars(o),this._load()}var t,n,r;return t=e,r=[{key:"_typeEncodingForValue",value:function(e){switch(o(e)){case"string":case"object":return"@";case"number":return"d";case"boolean":return"i";default:return null}}}],(n=[{key:"_createNibOwner",value:function(e){var t;do{t=e+NSUUID.UUID().UUIDString()}while(null!=NSClassFromString(t));this._cls=MOClassDescription.allocateDescriptionForClassWithName_superclass_(t,NSObject);var n=MOProtocolDescription.descriptionForProtocolWithName("NSObject");this._cls.addProtocol(n)}},{key:"_registerNibOwner",value:function(){this._cls.registerClass(),this._nibOwner=NSClassFromString(this._cls.name()).alloc().init()}},{key:"_prepareOutletConnections",value:function(e){for(var t=this,n=function(n){var r=e[n],i="set".concat(r.charAt(0).toUpperCase()).concat(r.substring(1),":");t._cls.addInstanceMethodWithSelector_function(NSSelectorFromString(i),(function(e){t.outlets[r]=e}))},r=0;r<e.length;r++)n(r)}},{key:"_connectDelegateMethods",value:function(){if(this._delegate){var e=[],t=null;if("window"in this.outlets?(e.push(this.outlets.window),t=this.outlets.window.contentView()):"view"in this.outlets&&(t=this.outlets.view),t&&(this._checkForTextViewsToConnect(t,e),e.length)){var n=this._getDelegateProxy();if(n){var r,i=a(e);try{for(i.s();!(r=i.n()).done;)r.value.setDelegate(n)}catch(e){i.e(e)}finally{i.f()}}}}}},{key:"_checkForTextViewsToConnect",value:function(e,t){for(var n=e.subviews(),r=0,i=Array.from(n);r<i.length;r++){var o=i[r];o.isKindOfClass(NSTextField)&&o.isEditable()&&o.tag()>0&&t.push(o),this._checkForTextViewsToConnect(o,t)}}},{key:"_getDelegateProxy",value:function(){if(!this._delegateProxy){for(var e={},t=0,n=["windowWillClose:","control:textShouldBeginEditing:","controlTextDidBeginEditing:","controlTextDidChange:","control:textShouldEndEditing:","controlTextDidEndEditing:"];t<n.length;t++){var r=n[t],o=r.replace(/(:.)/g,(function(e,t){return t.charAt(1).toUpperCase()})).replace(/:$/,""),a=this._delegate[o];a&&(e[r]=a.bind(this._delegate))}var l=new i.a(e);this._delegateProxy=l.getClassInstance()}return this._delegateProxy}},{key:"_connectActionsToDelegate",value:function(e,t){var n,r=this,i=a(e);try{var o=function(){var e=n.value,i=e.slice(0,-1),o=t[i];"function"==typeof o&&r._cls.addInstanceMethodWithSelector_function(NSSelectorFromString(e),(function(e){try{o.call(t,e)}catch(e){log(NSString.stringWithFormat("%@: %@\nStack:\n%@",e.name,e.message,e.stack))}}))};for(i.s();!(n=i.n()).done;)o()}catch(e){i.e(e)}finally{i.f()}}},{key:"_addIvars",value:function(e){for(var t=this,n=function(){var n=i[r],o=e[n],a=t.constructor._typeEncodingForValue(o);if(!a)return log("Cannot determine the type encoding for the ivar '".concat(n,"', value = ").concat(o)),"continue";t._cls.addInstanceVariableWithName_typeEncoding(n,a)?Object.defineProperty(t.ivars,n,{get:function(){return t.getIvar(n)},set:function(e){t.setIvar(n,e)}}):log("Unable to add ivar: "+n)},r=0,i=Object.keys(e);r<i.length;r++)n()}},{key:"_initIvars",value:function(e){for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t];this.setIvar(r,e[r])}}},{key:"_loadConnections",value:function(e){var t="".concat(this._bundle.resourcePath(),"/").concat(e,".json"),n=NSString.stringWithContentsOfFile_encoding_error(t,NSUTF8StringEncoding,null);return n?JSON.parse(n):{outlets:[],actions:[]}}},{key:"_load",value:function(){var e=MOPointer.alloc().initWithValue(null);if(!this._bundle.loadNibNamed_owner_topLevelObjects(this._nibName,this._nibOwner,e))throw new Error("Could not load nib '".concat(this._nibName,"'"));this._connectDelegateMethods()}},{key:"getIvar",value:function(e){return this._nibOwner.valueForKey(e)}},{key:"setIvar",value:function(e,t){this._nibOwner.setValue_forKey(t,e)}}])&&s(t.prototype,n),r&&s(t,r),e}(),u=n(2),h=n.n(u);function f(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,l=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){l=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(l)throw o}}}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var m=NSMakeSize(16,2);var S=function(){function e(t,n,r){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.context=t,this.sketch=h.a,this.styles=n,this.styleInfo=[],this.renamedStyles=[],this.find="",this.replace="",this.cellFontRegular=NSFont.systemFontOfSize(NSFont.systemFontSize()),this.cellFontBold=NSFont.boldSystemFontOfSize(NSFont.systemFontSize()),this.layerType=r,this.dialogTitle="Rename ".concat((i=r).charAt(0).toUpperCase()+i.slice(1)," Styles"),this.ivars={styles:n,renameCount:0,findPattern:"",ignoreCase:!1,useRegex:!1,replacePattern:"",showMatchingStyles:!1,autoScroll:!0,findColor:NSColor.textColor()}}var t,n,i;return t=e,(n=[{key:"makeAlert",value:function(){var e=NSAlert.new();e.setMessageText(this.dialogTitle);var t=NSImage.alloc().initByReferencingFile(this.context.plugin.urlForResourceNamed("rename-styles@2x.png").path());return e.setIcon(t),e}},{key:"loadNib",value:function(){this.nib=new c(this.context,"UIBundle","RenameStyles",this,this.ivars),this.nib.outlets.window.setTitle(this.dialogTitle),this.nib.outlets.versionLabel.setStringValue("v".concat(r.a))}},{key:"windowWillClose",value:function(){NSApp.stopModal()}},{key:"controlTextDidChange",value:function(e){var t=e.object().tag();1==t?this.searchForMatchingStyles():2==t&&this.updateReplacedNames()}},{key:"toggleShowOnlyMatchingStyles",value:function(){this.nib.ivars.showMatchingStyles.boolValue()||this.resetRenamedStyles(),this.searchForMatchingStyles()}},{key:"toggleFindOption",value:function(){this.searchForMatchingStyles()}},{key:"toggleAutoscroll",value:function(){this.scrollToFirstRenamedStyle()}},{key:"handleRename",value:function(){this.renameStyles(),NSApp.stopModal()}},{key:"handleApply",value:function(){this.applyRename()}},{key:"handleCancel",value:function(){NSApp.stopModal()}},{key:"applyRename",value:function(){this.renameStyles(),this.initStyleInfo(),this.nib.ivars.findPattern="",this.nib.ivars.replacePattern="",this.nib.ivars.showMatchingStyles=!1,this.nib.outlets.window.makeFirstResponder(this.nib.outlets.window.initialFirstResponder()),this.searchForMatchingStyles()}},{key:"scrollToFirstRenamedStyle",value:function(){if(this.nib.ivars.autoScroll.boolValue()){var e=this.nib.outlets.scrollView.contentInsets(),t=NSMakePoint(0,0);if(this.renamedStyles.length>0){for(var n=0;n<this.renamedStyles.length;n++)if(this.renamedStyles[n].newName.length>0){t=this.matrix.cellFrameAtRow_column(n,0).origin;break}}else t=this.matrix.cellFrameAtRow_column(0,0).origin;t.y-=e.top-1,this.matrix.scrollPoint(t),this.nib.outlets.scrollView.reflectScrolledClipView(this.nib.outlets.scrollView.contentView())}}},{key:"searchForMatchingStyles",value:function(){var e=this.nib.ivars.ignoreCase.boolValue()?"gi":"g",t=!!this.nib.ivars.useRegex.boolValue(),n=String(this.nib.ivars.findPattern||"");try{this.find=t?new RegExp(n,e):new RegExp(String(n).replace(/([-()[\]{}+?*.$^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"),e),this.nib.ivars.findColor=NSColor.textColor()}catch(t){this.nib.ivars.findColor=NSColor.redColor(),n="",this.find=new RegExp("",e)}this.updateStylesToRename(0===n.length),this.setMatrixData(),this.scrollToFirstRenamedStyle()}},{key:"updateReplacedNames",value:function(){this.replace=String(this.nib.ivars.replacePattern||""),this.updateRenamedStyles(),this.setMatrixData()}},{key:"initStyleInfo",value:function(){var e=this.styles.objects();this.styleInfo=new Array(e.length);for(var t=0;t<e.length;t++){var n=e[t];this.styleInfo[t]={style:n,name:n.name()}}this.styleInfo.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0})),this.nib.ivars.renameCount=0,this.resetRenamedStyles()}},{key:"resetRenamedStyles",value:function(){this.renamedStyles=new Array(this.styleInfo.length);for(var e=0;e<this.styleInfo.length;e++){var t=this.styleInfo[e];this.renamedStyles[e]={style:t.style,oldName:t.name,newName:""}}}},{key:"updateStylesToRename",value:function(e){for(var t=[],n=0,r=0;r<this.styleInfo.length;r++){var i=this.styleInfo[r],o=void 0;!e&&this.find.test(i.name)?(0===(o=i.name.replace(this.find,this.replace)).length?o="<empty>":n++,this.nib.ivars.showMatchingStyles.boolValue()?t.push({style:i.style,oldName:i.name,newName:o}):this.renamedStyles[r].newName=o):this.nib.ivars.showMatchingStyles.boolValue()||(this.renamedStyles[r].newName="")}this.nib.ivars.showMatchingStyles.boolValue()&&(this.renamedStyles=t),this.nib.ivars.renameCount=n}},{key:"updateRenamedStyles",value:function(){var e,t=0,n=f(this.renamedStyles);try{for(n.s();!(e=n.n()).done;){var r=e.value;r.newName&&(r.newName=r.oldName.replace(this.find,this.replace),0===r.newName.length?r.newName="<empty>":t++)}}catch(e){n.e(e)}finally{n.f()}this.nib.ivars.renameCount=t}},{key:"renameStyles",value:function(){var e,t=f(this.renamedStyles);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(n.newName.length>0){var r=n.style.copy();r.setName(n.newName),n.style.syncPropertiesFromObject(r)}}}catch(e){t.e(e)}finally{t.f()}this.context.document.reloadInspector()}},{key:"alignLabelWithColumn",value:function(e,t){var n=this.nib.outlets.scrollView.contentInsets(),r=this.nib.outlets.scrollView.frame().origin,i=this.matrix.cellFrameAtRow_column(0,t).origin,o=e.frame().origin;o.x=r.x+n.left+i.x,e.setFrameOrigin(o)}},{key:"setMatrixData",value:function(){var e=0;this.matrix.renewRows_columns(this.renamedStyles.length,2),this.matrix.sizeToCells();for(var t=this.matrix.cells(),n=0;n<this.renamedStyles.length;n++){var r=this.renamedStyles[n],i=2*n,o=t[i];o.setFont(0===r.newName.length?this.cellFontRegular:this.cellFontBold),o.setStringValue(r.oldName),this.matrix.drawCellAtRow_column(n,0);var a=o.cellSize();e=Math.max(e,a.width),(o=t[i+1]).setFont(this.cellFontRegular),o.setStringValue(r.newName),this.matrix.drawCellAtRow_column(n,1),a=o.cellSize(),e=Math.max(e,a.width)}return NSMakeSize(e,t[0].cellSize().height)}},{key:"initMatrix",value:function(){var e=NSBezelBorder,t=this.nib.outlets.scrollView.frame().size,n=NSScrollView.contentSizeForFrameSize_horizontalScrollerClass_verticalScrollerClass_borderType_controlSize_scrollerStyle(t,null,NSScroller,e,NSRegularControlSize,NSScrollerStyleOverlay),r=this.nib.outlets.scrollView.contentInsets();n.width-=r.left+r.right,n.height-=r.top+r.bottom;var i=NSMakeSize(100,16),o=NSCell.alloc().initTextCell("");this.matrix=NSMatrix.alloc().initWithFrame_mode_prototype_numberOfRows_numberOfColumns(NSMakeRect(0,0,2*i.width,i.height*this.renamedStyles.length),NSListModeMatrix,o,this.renamedStyles.length,2),(i=this.setMatrixData()).width*=1.25;var a=Math.floor(t.width/2);i.width=Math.max(i.width,a),this.matrix.setCellSize(CGSizeMake(i.width,i.height)),this.matrix.setIntercellSpacing(m),this.matrix.sizeToCells(),this.nib.outlets.scrollView.setDocumentView(this.matrix),this.alignLabelWithColumn(this.nib.outlets.beforeLabel,0),this.alignLabelWithColumn(this.nib.outlets.afterLabel,1);var l=27*i.height;l+=26*m.height;var s=NSMakeSize(this.matrix.frame().size.width,l),c=NSScrollView.frameSizeForContentSize_horizontalScrollerClass_verticalScrollerClass_borderType_controlSize_scrollerStyle(s,null,NSScroller,e,NSRegularControlSize,NSScrollerStyleOverlay);c.width+=r.left+r.right,c.height+=r.top+r.bottom;var u=NSMakeSize(c.width-t.width,c.height-t.height),h=this.nib.outlets.window.frame();h.size.width+=u.width,h.size.height+=u.height;var f=this.nib.outlets.window.minSize();h.size.width=Math.max(h.size.width,f.width),h.size.height=Math.max(h.size.height,f.height),this.nib.outlets.window.setFrame_display(h,!0)}},{key:"showAlert",value:function(e){var t=this.makeAlert();t.setInformativeText(e),t.runModal()}},{key:"showFindDialog",value:function(){if(0===this.styles.numberOfSharedStyles()){var e=this.makeAlert();return e.setInformativeText("This document has no shared ".concat(this.layerType," styles.")),e.runModal(),0}return this.loadNib(),this.initStyleInfo(),this.initMatrix(),NSApp.runModalForWindow(this.nib.outlets.window)}},{key:"run",value:function(){var e=this.showFindDialog();return 0!==e&&this.nib.outlets.window.orderOut(null),e}}])&&d(t.prototype,n),i&&d(t,i),e}();function g(e){var t=e.document.documentData().layerTextStyles();new S(e,t,"text").run()}function v(e){var t=e.document.documentData().layerStyles();new S(e,t,"layer").run()}}]);"default"===key&&"function"==typeof exports?exports(context):exports[key](context)}that.onRun=run.bind(this,"default"),that.renameTextStyles=run.bind(this,"renameTextStyles"),that.renameLayerStyles=run.bind(this,"renameLayerStyles");